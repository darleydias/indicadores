<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/estilos.css">
    <link rel="stylesheet" href="./css/painel.css">
    <script type="text/javascript" src="./js/funcao.js"></script>

    <!-- CONTROLLERS -->

    <script type="text/javascript" src="./controller/conquistadosController.js"></script>
    <script type="text/javascript" src="./controller/ticketController.js"></script>


    <!-- FIM CONTROLLERS -->


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js" integrity="sha512-7U4rRB8aGAHGVad3u2jiC7GA5/1YhQcQjxKeaVms/bT66i3LVBMRcBI9KwABNWnxOSwulkuSXxZLGuyfvo7V1A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>


    <link rel="stylesheet" href="https://cdn.es.gov.br/scripts/jquery/jquery-cookie/1.3.1/jquery.cookie.min.js"/>
    <script src="https://code.jquery.com/ui/1.11.3/jquery-ui.min.js" integrity="sha256-xI/qyl9vpwWFOXz7+x/9WkG5j/SVnSw21viy8fWwbeE=" crossorigin="anonymous"></script>

    <script src="./funcoes.js"></script>
    <script src="./js/transiction.min.js"></script>

    <title>Painel Produção</title>
    <link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment-with-locales.min.js" integrity="sha512-42PE0rd+wZ2hNXftlM78BSehIGzezNeQuzihiBCvUEB3CVxHvsShF86wBWwQORNxNINlBPuq7rG4WWhNiTVHFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

</head>
<body>

    <!-- Cabecalho -->
    <header style="position: relative; z-index: 999;">
        <nav class="cabecalho__container">
           <a class="logo__item" href="./portfolio.html"></a>

             <div class="cabecalho_pesquisar_item">
                <form action="">
                    <input type="search" placeholder="Pesquisar" id="pesquisar" class="pesquisar__input">
                    <label for="pesquisar" class="pesquisar__label"></label>
                </form>
                <a href="#" class="cabecalho__audio"></a>
            </div>
        </nav>
    </header>
    <div id="avo" style="display: flex; flex-flow: column;";>
        <div id="pai" style="display: flex; flex-flow: row;" ondragover="allowDrop(event)" ondrop="drop(event)" >
              <div style=" display:flex;flex-flow: row; margin-left:-100%;margin-bottom:0px;width: 100%;height: 100%;padding-left: 200px;padding-right: 200px; padding-bottom: 50%; border-radius: 0px;margin-top: 130px;">
                <div style="display:flex; width: 50%;margin: 100px;">
                    <canvas id="myChart"></canvas>
                </div>
            </div>
            <div style="display: flex;flex-flow: column; width: 100%;margin: -5px; height: 100%;margin-top: 100px;">
                <div id="cabecalho_tabela" style="position:fixed; display: flex;flex-flow: row; width: 100%;height:40px;margin: 0px ; margin-left: 5px; margin-top:-10px;padding:0px;padding-left: 0px; background-color: rgba(195, 188, 63, 0.708);">
                    <div id="mes" class="titulo-cabecalho" style="width: 5%;">Mês</div>
                    <div id="s1" class="titulo-cabecalho" style="width: 22%;">Semana 1</div>
                    <div id="s2" class="titulo-cabecalho" style="width: 22%;">Semana 2</div>
                    <div id="s3" class="titulo-cabecalho" style="width: 22%;">Semana 3</div>
                    <div id="s4" class="titulo-cabecalho" style="width: 22%;">Semana 4</div>
                </div>
                <div id="envelopeFooter" style="color:black;display:flex;flex-flow:row;justify-content: center;align-items: center; margin: 0px;padding:0px; width:100%;margin-top:34px;margin-left: 5px;">
                    <div style="display: flex;background-color: rgb(114, 110, 110); opacity: 0.5; border-radius:20px;width:16px;height: 16px;"></div>    
                    <div style="display: flex;background-color: rgb(128, 120, 120); border-radius:20px;width:16px;height: 16px;margin-left: 20px;"></div>    
                </div>
                <div id="envelope" class="envelope" style="display:flex;flex-flow:column;width:100%;margin-top:0px;margin-left:5px;margin-top:-40px;"></div>
                


            </div>
            <!-- menus suspensos -->
            <div style="display:flex;flex-flow: column;position:fixed;z-index:999;top:20%;left:90%;right:0px">
            <div id="1" style="color: antiquewhite; display: flex; width: 80px;height: 80px; border-radius: 40px; background-color: rgba(0, 0, 0, 0.444);margin-bottom: 10px; justify-content: center;align-items: center;" draggable="true" ondragstart="drag(event)" >
                <span class="material-symbols-outlined">
                    trophy
                    </span> 
            </div>
            <div id="2" style="display: flex;width: 80px;height: 80px;border-radius: 40px; background-color: rgba(0, 0, 0, 0.444); justify-content: center;align-items: center;margin-bottom: 10px;" draggable="true" ondragstart="drag(event  )">
                <span class="material-symbols-outlined">
                    tablet_android
                    </span>
            </div>
            <div id="3" style="display: flex;width: 80px;height: 80px;border-radius: 40px; background-color: rgba(0, 0, 0, 0.444); justify-content: center;align-items: center;margin-bottom: 10px;" draggable="true" ondragstart="drag(event)">
                <span class="material-symbols-outlined">
                    precision_manufacturing
                    </span>
            </div>
            <div id="4" style="display: flex;width: 80px;height: 80px;border-radius: 40px; background-color: rgba(0, 0, 0, 0.444); justify-content: center;align-items: center;margin-bottom: 10px;" draggable="true" ondragstart="drag(event)">
                <span class="material-symbols-outlined">
                    battery_change
                    </span>
            </div>
            <div id="5" style="display: flex;width: 80px;height: 80px;border-radius: 40px; background-color: rgba(0, 0, 0, 0.444); justify-content: center;align-items: center;margin-bottom: 10px;" draggable="true" ondragstart="drag(event)">
                <span class="material-symbols-outlined">
                    settings_input_hdmi
                    </span>
            </div>


            

        </div>  
    </div> 


<!-- ########################################### JavaScript ######################################################## -->
<script>

// DRAG AND DROP
// ############################
var salvaCookie = function() {
  var ordem = $('#drop-esquerda').sortable('toArray');
  ordem += '|' + $('#drop-direita').sortable('toArray');
  $.cookie('df_draganddrop', ordem);
};
function allowDrop(ev) {
      ev.preventDefault();
    }
    function drag(ev) {
      ev.dataTransfer.setData("text", ev.target.id);
      $(this).data('x', ev.target.id)
    }
    function drop(ev,ui) {
    //    alert($(this).data('x'));
       buscaAnos($(this).data('x'));
    }
    </script>
<script>

function rola(obj){
    document.getElementById("setaD").setAttribute('style','visibility:hidden');
    document.getElementById("setaE").setAttribute('style','visibility:visible');
    transition.begin(obj, {property: "transform", from: "translateX(100%)", to:"translateX(0%)", duration:"1s", timingfunction:"linear"});
}
function volta(obj){
    // document.getElementById("setaE").setAttribute('style','visibility:hidden');
    document.getElementById("setaD").setAttribute('style','visibility:visible');
    transition.begin(obj, {property: "transform", from: "translateX(0%)", to:"translateX(100%)", duration:"1s", timingfunction:"linear"});
}
function comeca(obj){
    transition.begin(obj, {property: "transform", from: "translateX(10%)", to:"translateX(0%)", duration:"1s", timingfunction:"linear"});
}
function aumenta(obj){
 
    obj.setAttribute('style','display:flex; flex-flow: row');
}       
const date =new Date();
const today = date.getDate();
const currentMonth = date.getMonth() + 1; 

// GRÁFICO
const ctx = document.getElementById('myChart');
  
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
      datasets: [{
        label: '# of Votes',
        data: [12, 19, 3, 5, 2, 3],
        borderWidth: 1
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });

// GRÁFICO FIM


var opNum="";

function FormataStringData(data) {
  var dataSemHora = data.split(" ")[0];
  var dia  = dataSemHora.split("-")[2];
  var mes  = dataSemHora.split("-")[1];
  var ano  = dataSemHora.split("-")[0];
  return (dia).slice(-2) + '-'+("0"+mes).slice(-2) + '-' + ano;
}
function queryString(parameter) {  
              var loc = location.search.substring(1, location.search.length);   
              var param_value = false;   
              var params = loc.split("&");   
              for (i=0; i<params.length;i++) {   
                  param_name = params[i].substring(0,params[i].indexOf('='));   
                  if (param_name == parameter) {                                          
                      param_value = params[i].substring(params[i].indexOf('=')+1)   
                  }   
              }   
              if (param_value) {   
                  return param_value;   
              }   
              else {   
                  return undefined;   
              }   
        }
var variavel = queryString("op");

// MONTA CALENDÁRIO

function buscaAnos(indicador){
   $.ajax({
            // Anos que têm oportunidade cadastradas

           url: "http://192.168.0.11:8000/api/omie/oportunidade/ano",
           type: 'GET',
           dataType: 'json',
           headers: {
               'Accept': 'application/json'
           },
           contentType: 'application/json; charset=utf-8',
           success: function (result) {
            var envelope=document.querySelector('#envelope');
  
            result.forEach((res) => {
                var txtDiv = document.createTextNode(res.ano); 
                var txtPeq="";
                if(indicador==1){
                    txtPeq = "Clientes conquistados"; 
                }
                if(indicador==2){
                    txtPeq = "Ticket"; 
                }
                var txtIcon = document.createTextNode(txtPeq); 
                var ano = document.createElement("div");
                ano.setAttribute('style','width:100%;display:flex;flex-flow: row;border-radius: 5px;color: #010000;font-weight: bold;font-size: large;padding: 40px;justify-content: center;align-items: center;background-color:#3e2b2b00;margin-bottom: 5px;margin-right: 50px;');
                var icon = document.createElement("div");
                icon.setAttribute('style','display:flex;flex-flow:row; width;60px;backgroud-image : url('+"./img/qualidade.jpeg"+'); heght:60px; border 1px solid #red; border-radious:50px;margin-right:200px;font-size:36px;border-radius:6px;padding:15px');
                icon.appendChild(txtIcon);
                var esq = document.createElement("div");
                esq.setAttribute('style','margin-right:200px;font-size:36px;display:flex;flex-flow:column;');
                esq.setAttribute('id','tituloInd');
                $("#tituloInd").html(txtPeq);
 
                var pontinhos = document.createElement("div");
                pontinhos.setAttribute('style','margin:0px;padding:0px;width:100%; height:60px;display:flex;flex-flow: row;color: #010000;font-weight: bold;font-size: 22px;padding: 0px;justify-content: center;align-items: center;');
                
                var ponto1 = document.createElement("div");
                ponto1.setAttribute('style','display:flex;background-color:red;width:15px; height:60px;padding: 0px;');
                var ponto2 = document.createElement("div");
                ponto2.setAttribute('style','display:flex;background-color:red;width:15px; height:60px;padding: 0px;');
                
                pontinhos.appendChild(ponto1);
                pontinhos.appendChild(ponto2);

                //$("#tituloInd").html("<div style='background-color:red;width:50px;height:60px;padding: 0px;'></div>");
                var dir = document.createElement("div");                
                dir.setAttribute('style','margin-right:200px;font-size:36px');
                dir.appendChild(txtDiv);
                
                ano.appendChild(icon);  
                ano.appendChild(dir);
                
                envelope.appendChild(ano);

              
                montaMeses(res.ano,envelope,indicador);
                
            });
           },
           error: function (error) {
               console.log(error);
           }
       });
}
buscaAnos(1);

// MONTAGEM INDICADORES

function montaMeses(ano,envelope,indicador){
    var tam=0;
    var total = "";
    var anoAtual=new Date().getFullYear();
    if(ano==anoAtual){total = currentMonth }else{total=12};
    
     for (var i = total; i>0;i--){ 
        tam=tam+1;
        var txtMes="";    
        if(i==1){txtMes="Janeiro"};if(i==2){txtMes="Fevereiro"};if(i==3){txtMes="Marco"};
        if(i==4){txtMes="Abril"};if(i==5){txtMes="Maio"};if(i==6){txtMes="Junho"};
        if(i==7){txtMes="Julho"};if(i==8){txtMes="Agosto"};if(i==9){txtMes="Setembro"};
        if(i==10){txtMes="Outubro"};if(i==11){txtMes="Novembro"};if(i==12){txtMes="Dezembro"};

                            var nomeMes = document.createTextNode(txtMes);
                            var link = document.createElement('button');
                            link.appendChild(nomeMes)
                            link.setAttribute('onClick','javascript:aumenta(document.getElementById(\'mes'+i+'\'))');
                            
                            var meses = document.getElementById("meses");
                            // cria semanas
                            var semana1 = document.createElement("div");
                            var semana2 = document.createElement("div");
                            var semana3 = document.createElement("div");
                            var semana4 = document.createElement("div");

                            if(currentMonth){                           
                            semana1.setAttribute('style','font-size:28px;background-color: #fff; display: flex;justify-content: center; align-items: center; margin-left: 10px; width: 22%;');
                            }
                            semana1.classList.add("semana");
                            semana1.setAttribute('id','1_'+ano+'_'+i);
                        
                            semana2.setAttribute('style','font-size: 28px;background-color: #fff;;display: flex;justify-content: center; align-items: center; margin-left: 10px; width: 22%;');
                            semana2.classList.add("semana");
                            semana2.setAttribute('id','2_'+ano+'_'+i);

                           
                            semana3.setAttribute('style','font-size: 28px;background-color: #fff;display: flex;justify-content: center; align-items: center; margin-left: 10px; width: 22%;');
                            semana3.classList.add("semana");
                            semana3.setAttribute('id','3_'+ano+'_'+i);

                        
                            semana4.setAttribute('style','font-size: 28px;background-color: #fff;display: flex;justify-content: center; align-items: center; margin-left: 10px; width: 22%;');
                            semana4.classList.add("semana");
                            semana4.setAttribute('id','4_'+ano+'_'+i);

                            var semanas =[];
                            
                            var ValorMes1 = document.createTextNode("");
                            var ValorMes2 = document.createTextNode("");
                            var ValorMes3 = document.createTextNode("");
                                var ValorMes4 = document.createTextNode("");
                            // ############################# CHAMA OS CONTROLLERS #############################
                            
                            if(indicador==1){     
                                semanas = conquistados(ano,i);
                            }
                            if(indicador==2){     
                                semanas = ticket(ano,i);
                            }
                            // #############

                            semana1.appendChild(ValorMes1);
                            semana2.appendChild(ValorMes2);
                            semana3.appendChild(ValorMes3);
                            semana4.appendChild(ValorMes4);
                            
                            var mesDiv = document.createElement("div");
                            mesDiv.appendChild(link);
                            mesDiv.setAttribute('style','display: flex; flex-flow: row;');
                            mesDiv.classList.add("mes1");
                            
                            var wrapperMes = document.createElement("div");
                            wrapperMes.setAttribute('style','display:flex; flex-flow: row');
                            wrapperMes.setAttribute('id','mes'+i);
                            
                            wrapperMes.appendChild(mesDiv);
                            wrapperMes.appendChild(semana1);
                            wrapperMes.appendChild(semana2);
                            wrapperMes.appendChild(semana3);
                            wrapperMes.appendChild(semana4);
                            envelope.appendChild(wrapperMes);
     }
                   
}
 </script>
    

</body>

</html>